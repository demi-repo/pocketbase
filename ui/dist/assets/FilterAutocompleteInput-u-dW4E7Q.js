import{S as le,i as ce,s as ue,e as de,f as fe,g as he,x as H,o as ge,J as pe,K as ye,L as me,I as ke,C as h,M as xe}from"./index--mEa_Dg9.js";import{E as R,a as I,h as be,b as we,c as Ee,d as Ke,e as Se,s as Ce,f as qe,g as Re,r as Ie,i as Le,k as _e,j as ve,l as Ae,m as De,n as Oe,o as Be,p as Me,q as j,C as v,S as He,t as Fe,u as Te}from"./index-u64XbdBO.js";function Ue(e){$(e,"start");var o={},n=e.languageData||{},y=!1;for(var m in e)if(m!=n&&e.hasOwnProperty(m))for(var g=o[m]=[],s=e[m],r=0;r<s.length;r++){var l=s[r];g.push(new Je(l,e)),(l.indent||l.dedent)&&(y=!0)}return{name:n.name,startState:function(){return{state:"start",pending:null,indent:y?[]:null}},copyState:function(a){var b={state:a.state,pending:a.pending,indent:a.indent&&a.indent.slice(0)};return a.stack&&(b.stack=a.stack.slice(0)),b},token:Pe(o),indent:Ve(o,n),languageData:n}}function $(e,o){if(!e.hasOwnProperty(o))throw new Error("Undefined state "+o+" in simple mode")}function We(e,o){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((o===!1?"":"^")+"(?:"+e+")",n)}function Ne(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var o=[],n=0;n<e.length;n++)o.push(e[n]&&e[n].replace(/\./g," "));return o}function Je(e,o){(e.next||e.push)&&$(o,e.next||e.push),this.regex=We(e.regex),this.token=Ne(e.token),this.data=e}function Pe(e){return function(o,n){if(n.pending){var y=n.pending.shift();return n.pending.length==0&&(n.pending=null),o.pos+=y.text.length,y.token}for(var m=e[n.state],g=0;g<m.length;g++){var s=m[g],r=(!s.data.sol||o.sol())&&o.match(s.regex);if(r){s.data.next?n.state=s.data.next:s.data.push?((n.stack||(n.stack=[])).push(n.state),n.state=s.data.push):s.data.pop&&n.stack&&n.stack.length&&(n.state=n.stack.pop()),s.data.indent&&n.indent.push(o.indentation()+o.indentUnit),s.data.dedent&&n.indent.pop();var l=s.token;if(l&&l.apply&&(l=l(r)),r.length>2&&s.token&&typeof s.token!="string"){n.pending=[];for(var a=2;a<r.length;a++)r[a]&&n.pending.push({text:r[a],token:s.token[a-1]});return o.backUp(r[0].length-(r[1]?r[1].length:0)),l[0]}else return l&&l.join?l[0]:l}}return o.next(),null}}function Ve(e,o){return function(n,y){if(n.indent==null||o.dontIndentStates&&o.doneIndentState.indexOf(n.state)>-1)return null;var m=n.indent.length-1,g=e[n.state];e:for(;;){for(var s=0;s<g.length;s++){var r=g[s];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var l=r.regex.exec(y);if(l&&l[0]){m--,(r.next||r.push)&&(g=e[r.next||r.push]),y=y.slice(l[0].length);continue e}}}break}return m<0?0:n.indent[m]}}function Ge(e){let o;return{c(){o=de("div"),fe(o,"class","code-editor")},m(n,y){he(n,o,y),e[15](o)},p:H,i:H,o:H,d(n){n&&ge(o),e[15](null)}}}function ze(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.schema])}function Qe(e,o,n){let y;pe(e,ye,t=>n(21,y=t));const m=me();let{id:g=""}=o,{value:s=""}=o,{disabled:r=!1}=o,{placeholder:l=""}=o,{baseCollection:a=null}=o,{singleLine:b=!1}=o,{extraAutocompleteKeys:A=[]}=o,{disableRequestKeys:K=!1}=o,{disableIndirectCollectionsKeys:C=!1}=o,f,w,D=r,F=new v,T=new v,U=new v,W=new v,q=[],N=[],J=[],P=[],L="",O="";function B(){f==null||f.focus()}let M=null;function ee(){clearTimeout(M),M=setTimeout(()=>{q=te(y),P=ne(),N=K?[]:oe(),J=C?[]:ie()},300)}function te(t){let i=t.slice();return a&&h.pushOrReplaceByKey(i,a,"id"),i}function V(){w==null||w.dispatchEvent(new CustomEvent("change",{detail:{value:s},bubbles:!0}))}function G(){if(!g)return;const t=document.querySelectorAll('[for="'+g+'"]');for(let i of t)i.removeEventListener("click",B)}function z(){if(!g)return;G();const t=document.querySelectorAll('[for="'+g+'"]');for(let i of t)i.addEventListener("click",B)}function S(t,i="",c=0){var k,x,X,Y;let u=q.find(p=>p.name==t||p.id==t);if(!u||c>=4)return[];u.schema=u.schema||[];let d=h.getAllCollectionIdentifiers(u,i);for(const p of u.schema){const E=i+p.name;if(p.type==="relation"&&((k=p.options)!=null&&k.collectionId)){const _=S(p.options.collectionId,E+".",c+1);_.length&&(d=d.concat(_))}p.type==="select"&&((x=p.options)==null?void 0:x.maxSelect)!=1&&d.push(E+":each"),((X=p.options)==null?void 0:X.maxSelect)!=1&&["select","file","relation"].includes(p.type)&&d.push(E+":length")}for(const p of q){p.schema=p.schema||[];for(const E of p.schema)if(E.type=="relation"&&((Y=E.options)==null?void 0:Y.collectionId)==u.id){const _=i+p.name+"_via_"+E.name,Z=S(p.id,_+".",c+2);Z.length&&(d=d.concat(Z))}}return d}function ne(){return S(a==null?void 0:a.name)}function oe(){const t=[];t.push("@request.context"),t.push("@request.method"),t.push("@request.query."),t.push("@request.data."),t.push("@request.headers."),t.push("@request.auth.id"),t.push("@request.auth.collectionId"),t.push("@request.auth.collectionName"),t.push("@request.auth.verified"),t.push("@request.auth.username"),t.push("@request.auth.email"),t.push("@request.auth.emailVisibility"),t.push("@request.auth.created"),t.push("@request.auth.updated");const i=q.filter(u=>u.type==="auth");for(const u of i){const d=S(u.id,"@request.auth.");for(const k of d)h.pushUnique(t,k)}const c=["created","updated"];if(a!=null&&a.id){const u=S(a.name,"@request.data.");for(const d of u){t.push(d);const k=d.split(".");k.length===3&&k[2].indexOf(":")===-1&&!c.includes(k[2])&&t.push(d+":isset")}}return t}function ie(){const t=[];for(const i of q){const c="@collection."+i.name+".",u=S(i.name,c);for(const d of u)t.push(d)}return t}function re(t=!0,i=!0){let c=[].concat(A);return c=c.concat(P||[]),t&&(c=c.concat(N||[])),i&&(c=c.concat(J||[])),c.sort(function(u,d){return u.length-d.length}),c}function se(t){var k;let i=t.matchBefore(/[\'\"\@\w\.]*/);if(i&&i.from==i.to&&!t.explicit)return null;let c=Te(t.state).resolveInner(t.pos,-1);if(((k=c==null?void 0:c.type)==null?void 0:k.name)=="comment")return null;let u=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];C||u.push({label:"@collection.*",apply:"@collection."});const d=re(!K,!K&&i.text.startsWith("@c"));for(const x of d)u.push({label:x.endsWith(".")?x+"*":x,apply:x});return{from:i.from,options:u}}function Q(){return He.define(Ue({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:h.escapeRegExp("@now"),token:"keyword"},{regex:h.escapeRegExp("@second"),token:"keyword"},{regex:h.escapeRegExp("@minute"),token:"keyword"},{regex:h.escapeRegExp("@hour"),token:"keyword"},{regex:h.escapeRegExp("@year"),token:"keyword"},{regex:h.escapeRegExp("@day"),token:"keyword"},{regex:h.escapeRegExp("@month"),token:"keyword"},{regex:h.escapeRegExp("@weekday"),token:"keyword"},{regex:h.escapeRegExp("@todayStart"),token:"keyword"},{regex:h.escapeRegExp("@todayEnd"),token:"keyword"},{regex:h.escapeRegExp("@monthStart"),token:"keyword"},{regex:h.escapeRegExp("@monthEnd"),token:"keyword"},{regex:h.escapeRegExp("@yearStart"),token:"keyword"},{regex:h.escapeRegExp("@yearEnd"),token:"keyword"},{regex:h.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}ke(()=>{const t={key:"Enter",run:i=>{b&&m("submit",s)}};return z(),n(11,f=new R({parent:w,state:I.create({doc:s,extensions:[be(),we(),Ee(),Ke(),Se(),I.allowMultipleSelections.of(!0),Ce(Fe,{fallback:!0}),qe(),Re(),Ie(),Le(),_e.of([t,...ve,...Ae,De.find(i=>i.key==="Mod-d"),...Oe,...Be]),R.lineWrapping,Me({override:[se],icons:!1}),W.of(j(l)),T.of(R.editable.of(!r)),U.of(I.readOnly.of(r)),F.of(Q()),I.transactionFilter.of(i=>{var c,u,d;if(b&&i.newDoc.lines>1){if(!((d=(u=(c=i.changes)==null?void 0:c.inserted)==null?void 0:u.filter(k=>!!k.text.find(x=>x)))!=null&&d.length))return[];i.newDoc.text=[i.newDoc.text.join(" ")]}return i}),R.updateListener.of(i=>{!i.docChanged||r||(n(1,s=i.state.doc.toString()),V())})]})})),()=>{clearTimeout(M),G(),f==null||f.destroy()}});function ae(t){xe[t?"unshift":"push"](()=>{w=t,n(0,w)})}return e.$$set=t=>{"id"in t&&n(2,g=t.id),"value"in t&&n(1,s=t.value),"disabled"in t&&n(3,r=t.disabled),"placeholder"in t&&n(4,l=t.placeholder),"baseCollection"in t&&n(5,a=t.baseCollection),"singleLine"in t&&n(6,b=t.singleLine),"extraAutocompleteKeys"in t&&n(7,A=t.extraAutocompleteKeys),"disableRequestKeys"in t&&n(8,K=t.disableRequestKeys),"disableIndirectCollectionsKeys"in t&&n(9,C=t.disableIndirectCollectionsKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&n(13,L=ze(a)),e.$$.dirty[0]&25352&&!r&&(O!=L||K!==-1||C!==-1)&&(n(14,O=L),ee()),e.$$.dirty[0]&4&&g&&z(),e.$$.dirty[0]&2080&&f&&a!=null&&a.schema&&f.dispatch({effects:[F.reconfigure(Q())]}),e.$$.dirty[0]&6152&&f&&D!=r&&(f.dispatch({effects:[T.reconfigure(R.editable.of(!r)),U.reconfigure(I.readOnly.of(r))]}),n(12,D=r),V()),e.$$.dirty[0]&2050&&f&&s!=f.state.doc.toString()&&f.dispatch({changes:{from:0,to:f.state.doc.length,insert:s}}),e.$$.dirty[0]&2064&&f&&typeof l<"u"&&f.dispatch({effects:[W.reconfigure(j(l))]})},[w,s,g,r,l,a,b,A,K,C,B,f,D,L,O,ae]}class Ze extends le{constructor(o){super(),ce(this,o,Qe,Ge,ue,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Ze as default};
