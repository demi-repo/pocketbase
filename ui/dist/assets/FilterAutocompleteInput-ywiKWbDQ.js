import{S as Z,i as $,s as ee,e as te,f as ne,g as re,x as D,o as ae,J as ie,K as oe,L as le,I as se,C as f,M as de}from"./index-z3vRI80T.js";import{E as w,a as E,h as ce,b as fe,c as ue,d as ge,e as he,s as ye,f as pe,g as me,r as ke,i as xe,k as be,j as we,l as Ee,m as Se,n as Ke,o as Ce,p as Re,q as Le,t as G,C as R,S as qe,u as ve,v as Oe}from"./index-8bZ4r7AC.js";function We(e){return new Worker(""+new URL("autocomplete.worker-8hFaOFLh.js",import.meta.url).href,{name:e==null?void 0:e.name})}function _e(e){V(e,"start");var n={},t=e.languageData||{},u=!1;for(var h in e)if(h!=t&&e.hasOwnProperty(h))for(var c=n[h]=[],i=e[h],a=0;a<i.length;a++){var l=i[a];c.push(new Je(l,e)),(l.indent||l.dedent)&&(u=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:u?[]:null}},copyState:function(s){var y={state:s.state,pending:s.pending,indent:s.indent&&s.indent.slice(0)};return s.stack&&(y.stack=s.stack.slice(0)),y},token:Me(n),indent:Ae(n,t),languageData:t}}function V(e,n){if(!e.hasOwnProperty(n))throw new Error("Undefined state "+n+" in simple mode")}function De(e,n){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e=e.source):e=String(e),new RegExp((n===!1?"":"^")+"(?:"+e+")",t)}function Ie(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var n=[],t=0;t<e.length;t++)n.push(e[t]&&e[t].replace(/\./g," "));return n}function Je(e,n){(e.next||e.push)&&V(n,e.next||e.push),this.regex=De(e.regex),this.token=Ie(e.token),this.data=e}function Me(e){return function(n,t){if(t.pending){var u=t.pending.shift();return t.pending.length==0&&(t.pending=null),n.pos+=u.text.length,u.token}for(var h=e[t.state],c=0;c<h.length;c++){var i=h[c],a=(!i.data.sol||n.sol())&&n.match(i.regex);if(a){i.data.next?t.state=i.data.next:i.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=i.data.push):i.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),i.data.indent&&t.indent.push(n.indentation()+n.indentUnit),i.data.dedent&&t.indent.pop();var l=i.token;if(l&&l.apply&&(l=l(a)),a.length>2&&i.token&&typeof i.token!="string"){t.pending=[];for(var s=2;s<a.length;s++)a[s]&&t.pending.push({text:a[s],token:i.token[s-1]});return n.backUp(a[0].length-(a[1]?a[1].length:0)),l[0]}else return l&&l.join?l[0]:l}}return n.next(),null}}function Ae(e,n){return function(t,u){if(t.indent==null||n.dontIndentStates&&n.doneIndentState.indexOf(t.state)>-1)return null;var h=t.indent.length-1,c=e[t.state];e:for(;;){for(var i=0;i<c.length;i++){var a=c[i];if(a.data.dedent&&a.data.dedentIfLineStart!==!1){var l=a.regex.exec(u);if(l&&l[0]){h--,(a.next||a.push)&&(c=e[a.next||a.push]),u=u.slice(l[0].length);continue e}}}break}return h<0?0:t.indent[h]}}function Be(e){let n;return{c(){n=te("div"),ne(n,"class","code-editor")},m(t,u){re(t,n,u),e[15](n)},p:D,i:D,o:D,d(t){t&&ae(n),e[15](null)}}}function Fe(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.schema])}function He(e,n,t){let u;ie(e,oe,r=>t(21,u=r));const h=le();let{id:c=""}=n,{value:i=""}=n,{disabled:a=!1}=n,{placeholder:l=""}=n,{baseCollection:s=null}=n,{singleLine:y=!1}=n,{extraAutocompleteKeys:L=[]}=n,{disableRequestKeys:b=!1}=n,{disableCollectionJoinKeys:k=!1}=n,d,p,q=a,I=new R,J=new R,M=new R,A=new R,v=new We,B=[],F=[],H=[],S="",O="";function W(){d==null||d.focus()}let _=null;v.onmessage=r=>{H=r.data.baseKeys||[],B=r.data.requestKeys||[],F=r.data.collectionJoinKeys||[]};function j(){clearTimeout(_),_=setTimeout(()=>{v.postMessage({baseCollection:s,collections:z(u),disableRequestKeys:b,disableCollectionJoinKeys:k})},250)}function z(r){let o=r.slice();return s&&f.pushOrReplaceByKey(o,s,"id"),o}function T(){p==null||p.dispatchEvent(new CustomEvent("change",{detail:{value:i},bubbles:!0}))}function U(){if(!c)return;const r=document.querySelectorAll('[for="'+c+'"]');for(let o of r)o.removeEventListener("click",W)}function N(){if(!c)return;U();const r=document.querySelectorAll('[for="'+c+'"]');for(let o of r)o.addEventListener("click",W)}function Q(r=!0,o=!0){let g=[].concat(L);return g=g.concat(H||[]),r&&(g=g.concat(B||[])),o&&(g=g.concat(F||[])),g}function X(r){var C;let o=r.matchBefore(/[\'\"\@\w\.]*/);if(o&&o.from==o.to&&!r.explicit)return null;let g=Oe(r.state).resolveInner(r.pos,-1);if(((C=g==null?void 0:g.type)==null?void 0:C.name)=="comment")return null;let x=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];k||x.push({label:"@collection.*",apply:"@collection."});let K=Q(!b&&o.text.startsWith("@r"),!k&&o.text.startsWith("@c"));for(const m of K)x.push({label:m.endsWith(".")?m+"*":m,apply:m,boost:m.indexOf("_via_")>0?-1:0});return{from:o.from,options:x}}function P(){return qe.define(_e({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:f.escapeRegExp("@now"),token:"keyword"},{regex:f.escapeRegExp("@second"),token:"keyword"},{regex:f.escapeRegExp("@minute"),token:"keyword"},{regex:f.escapeRegExp("@hour"),token:"keyword"},{regex:f.escapeRegExp("@year"),token:"keyword"},{regex:f.escapeRegExp("@day"),token:"keyword"},{regex:f.escapeRegExp("@month"),token:"keyword"},{regex:f.escapeRegExp("@weekday"),token:"keyword"},{regex:f.escapeRegExp("@todayStart"),token:"keyword"},{regex:f.escapeRegExp("@todayEnd"),token:"keyword"},{regex:f.escapeRegExp("@monthStart"),token:"keyword"},{regex:f.escapeRegExp("@monthEnd"),token:"keyword"},{regex:f.escapeRegExp("@yearStart"),token:"keyword"},{regex:f.escapeRegExp("@yearEnd"),token:"keyword"},{regex:f.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}se(()=>{const r={key:"Enter",run:o=>{y&&h("submit",i)}};return N(),t(11,d=new w({parent:p,state:E.create({doc:i,extensions:[ce(),fe(),ue(),ge(),he(),E.allowMultipleSelections.of(!0),ye(ve,{fallback:!0}),pe(),me(),ke(),xe(),be.of([r,...we,...Ee,Se.find(o=>o.key==="Mod-d"),...Ke,...Ce,Re]),w.lineWrapping,Le({override:[X],icons:!1}),A.of(G(l)),J.of(w.editable.of(!a)),M.of(E.readOnly.of(a)),I.of(P()),E.transactionFilter.of(o=>{var g,x,K;if(y&&o.newDoc.lines>1){if(!((K=(x=(g=o.changes)==null?void 0:g.inserted)==null?void 0:x.filter(C=>!!C.text.find(m=>m)))!=null&&K.length))return[];o.newDoc.text=[o.newDoc.text.join(" ")]}return o}),w.updateListener.of(o=>{!o.docChanged||a||(t(1,i=o.state.doc.toString()),T())})]})})),()=>{clearTimeout(_),U(),d==null||d.destroy(),v.terminate()}});function Y(r){de[r?"unshift":"push"](()=>{p=r,t(0,p)})}return e.$$set=r=>{"id"in r&&t(2,c=r.id),"value"in r&&t(1,i=r.value),"disabled"in r&&t(3,a=r.disabled),"placeholder"in r&&t(4,l=r.placeholder),"baseCollection"in r&&t(5,s=r.baseCollection),"singleLine"in r&&t(6,y=r.singleLine),"extraAutocompleteKeys"in r&&t(7,L=r.extraAutocompleteKeys),"disableRequestKeys"in r&&t(8,b=r.disableRequestKeys),"disableCollectionJoinKeys"in r&&t(9,k=r.disableCollectionJoinKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&t(13,S=Fe(s)),e.$$.dirty[0]&25352&&!a&&(O!=S||b!==-1||k!==-1)&&(t(14,O=S),j()),e.$$.dirty[0]&4&&c&&N(),e.$$.dirty[0]&2080&&d&&s!=null&&s.schema&&d.dispatch({effects:[I.reconfigure(P())]}),e.$$.dirty[0]&6152&&d&&q!=a&&(d.dispatch({effects:[J.reconfigure(w.editable.of(!a)),M.reconfigure(E.readOnly.of(a))]}),t(12,q=a),T()),e.$$.dirty[0]&2050&&d&&i!=d.state.doc.toString()&&d.dispatch({changes:{from:0,to:d.state.doc.length,insert:i}}),e.$$.dirty[0]&2064&&d&&typeof l<"u"&&d.dispatch({effects:[A.reconfigure(G(l))]})},[p,i,c,a,l,s,y,L,b,k,W,d,q,S,O,Y]}class Ne extends Z{constructor(n){super(),$(this,n,He,Be,ee,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableCollectionJoinKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Ne as default};
